用户问题重写（Question Rewriting）是 RAG 或问答系统中极其重要的一环，主要用于**消除用户问题中的省略、歧义、指代**，将对话上下文和当前提问融合为完整、明确的问题，从而提升检索和生成效果。

常见的用户问题重写处理方式包括：

---

## 1. 基于模板的简单拼接

适用于上下文简单、业务明确场景。

**例：**
> 历史上下文：  
用户：我的快递没到  
当前提问：怎么办？  
**重写后问题**：我的快递没到，我该怎么办？

---

## 2. 规则/正则表达式替换

通过规则或正则捕获指代（如“它”、“这里”、“这样”），结合历史对话补全。

**例：**
- 识别“它”指代上一轮提到的“快递”。
- 用规则将“它”替换为具体对象。

---

## 3. Prompt 工程+LLM（大模型重写）

用 GPT-4、Claude、LLaMA2、Qwen 等大模型，结合 prompt 自动融合历史上下文和当前提问，输出完整问题。

**示例 Prompt**：
```text
你是一个问答助手，用户会分多轮提问。请将当前问题与历史对话结合，重写为一个清晰、独立的问题。
历史对话：
用户：我的电脑开不了机。
助手：请问有提示灯亮吗？
用户：没有。
当前问题：怎么办？
重写后问题：
```
**输出**：我的电脑开不了机，没有提示灯亮，我该怎么办？

---

## 4. 使用专用的 Question Rewriting 模型

已有公开的、针对对话重写训练的模型（如 [T5 Question Rewriter](https://huggingface.co/transformers/task_summary.html#question-generation)）。  
- 输入历史对话和当前问题，模型自动生成完整表述。

---

## 5. 端到端对话理解模型

部分大模型（如 GPT-4、ChatGLM3）本身具备“消解上下文”的能力，直接用多轮对话输入检索或生成，无需显式重写。但在检索场景，**显式重写效果更可控**。

---

## 6. 结合业务知识做实体消歧和补全

- 利用知识图谱、用户画像，将“他”、“那个”类指代词替换为具名实体。
- 适合金融、电商、医疗等垂直领域。

---

## 7. 多轮摘要+重写

- 先用摘要模型压缩多轮长对话，再结合当前问题做重写，适合复杂上下文。

---

## 8. 人工审核混合流

- 在高风险场景（如政务/医疗），自动重写后可设置人工确认环节。

---

## 典型开源工具

- [LangChain Question Rewriter](https://python.langchain.com/docs/modules/memory/)
- [LlamaIndex Conversational Query Transformer](https://docs.llamaindex.ai/en/stable/examples/query_engine/conversational_retrieval/)

---

## 方案对比表

| 方式                        | 优点              | 缺点                | 推荐场景                   |
|-----------------------------|-------------------|---------------------|----------------------------|
| 模板拼接/规则               | 快速、可控        | 智能度有限          | 问题简单、上下文短         |
| 正则+规则                   | 定向消歧          | 复杂对话效果有限    | 指代简单、对象固定         |
| LLM 模型重写                | 智能、灵活        | 需算力、成本较高    | 多轮复杂对话、高精度场景   |
| 专用重写模型                | 针对性强          | 需训练/适配         | 大量对话问答数据           |
| 端到端大模型理解            | 无需显式重写      | 可控性弱            | 生成场景、对检索容忍性高   |
| 知识图谱实体消歧            | 精准、可追溯      | 实现成本高          | 行业/专业领域              |
| 摘要+重写                   | 支持长对话        | 处理慢，需双模型     | 多轮长对话                 |
| 人工审核                    | 高安全            | 人工成本高          | 高风险行业                |

---

如有特定业务场景或想用的工具，可以告诉我，我可以给出更具体的推荐和代码示例！